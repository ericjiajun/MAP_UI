# 导出坐标功能使用指南

## 功能概述

导出坐标功能允许您将已绘制的多边形对象的坐标导出为米制（xy）格式。这对于以下场景非常有用：
- 将编辑器中的建筑物导出到CAD软件
- 备份精确的测量数据
- 与其他使用米制坐标的系统集成
- 生成用于其他分析的坐标数据

## 使用步骤

### 1. 选择要导出的对象

在画布上**选择一个或多个多边形对象**：
- 单击多边形选择单个对象
- 按住 Ctrl/Cmd 键并点击可多选

### 2. 打开导出对话框

点击工具栏中的 **"导出坐标"** 按钮（绿色背景）

### 3. 配置导出选项

#### 参考点设置

选择米制坐标的参考原点：

- **使用当前中心点**：使用当前视图中心作为 (0,0) 参考点
- **使用第一个节点**：使用所选对象的第一个坐标点作为 (0,0)
- **自定义经纬度**：手动输入参考点的经纬度坐标
  - 格式：`116.3975, 39.9085`（经度，纬度）

#### 导出格式

选择导出的文件格式：

**CSV格式**（默认推荐）：
```
x,y
12.50,8.30
22.50,8.30
22.50,0.00
12.50,0.00
12.50,8.30
```
- 易于在Excel、CAD软件中使用
- 第一行为列标题

**JSON格式**：
```json
{
  "reference": {
    "lon": 116.3975,
    "lat": 39.9085
  },
  "coordinateType": "meters",
  "objects": [
    {
      "id": "way_1",
      "type": "way",
      "coordinates": [
        {"x": 12.5, "y": 8.3},
        {"x": 22.5, "y": 8.3}
      ]
    }
  ]
}
```
- 包含完整的元数据（参考点、对象ID、标签等）
- 适合程序化处理

**空格分隔格式**：
```
12.50 8.30
22.50 8.30
22.50 0.00
12.50 0.00
12.50 8.30
```
- 最简洁的格式
- 适合某些旧版软件

#### 其他选项

- **包含闭合点**：勾选后，如果多边形是闭合的（最后一点等于第一点），导出时会包含这个重复点
- **小数位数**：设置坐标的精度（0-10位小数，默认2位）

### 4. 预览和导出

- **预览区域**：实时显示将要导出的数据内容
- **复制到剪贴板**：点击后数据会复制到系统剪贴板，可直接粘贴到其他应用
- **下载文件**：
  - CSV格式 → 下载为 `.csv` 文件
  - JSON格式 → 下载为 `.json` 文件
  - 空格分隔 → 下载为 `.txt` 文件

## 坐标转换说明

### 经纬度 → 米制坐标转换

导出时使用**等距圆柱投影（Equirectangular Projection）**进行转换：

```
dx_meters = (lon - lon_ref) × 111320 × cos(lat_ref)
dy_meters = (lat - lat_ref) × 111320
```

其中：
- `111320` 是赤道上每度约111.32公里的转换系数
- `cos(lat_ref)` 是纬度修正因子，因为经度距离随纬度变化

### 精度说明

- **纬度方向**：每度约 111,320 米（全球一致）
- **经度方向**：随纬度变化
  - 赤道（0°）：每度约 111,320 米
  - 北纬30°：每度约 96,486 米
  - 北纬60°：每度约 55,660 米

对于小范围区域（如单个建筑物或小区），这种转换方法误差在厘米级，完全满足精度要求。

## 典型使用场景

### 场景1：导出到CAD软件

1. 在编辑器中绘制建筑物多边形
2. 选择多边形，点击"导出坐标"
3. 选择"CSV格式"，使用"第一个节点"作为参考点
4. 下载CSV文件
5. 在AutoCAD中导入坐标：
   ```
   命令：PLINE
   从点：导入第一个坐标
   到点：逐个导入后续坐标
   ```

### 场景2：备份测量数据

1. 完成室内建筑物坐标输入后
2. 选择所有对象（Ctrl+A）
3. 导出为JSON格式（包含完整元数据）
4. 保存JSON文件作为数据备份

### 场景3：与其他系统集成

1. 导出为空格分隔格式（最简洁）
2. 复制到剪贴板
3. 直接粘贴到需要xy坐标的其他软件中

## 与导入功能配合使用

### 往返流程

```
原始数据 → 批量坐标导入 → 在编辑器中调整
                 ↓
            导出坐标 → 验证/备份
```

### 测试导入导出一致性

1. 准备测试数据（test_coordinates.txt）：
   ```
   0.00 0.00
   10.00 0.00
   10.00 8.00
   0.00 8.00
   0.00 0.00
   ```

2. 使用"手动输入"功能，输入坐标类型为"米"，使用临时原点(0,0)

3. 创建矩形后，选中它并导出

4. 选择"使用第一个节点"作为参考点，导出为空格分隔格式

5. 对比导出的数据与原始数据，应该完全一致

## 注意事项

1. **必须先选择对象**：如果没有选中任何多边形，点击"导出坐标"会提示错误

2. **参考点的重要性**：
   - 所有坐标都是相对于参考点的偏移量
   - 如果要与导入时的坐标一致，务必使用相同的参考点

3. **坐标系统**：
   - 导出始终使用**米制坐标**（xy）
   - x轴对应东西方向（经度），y轴对应南北方向（纬度）

4. **多对象导出**：
   - 可以同时选中多个多边形导出
   - JSON格式会为每个对象单独列出坐标
   - CSV和空格分隔格式会依次列出所有点

5. **闭合点处理**：
   - 大多数CAD软件可以自动闭合多边形，建议**不勾选**"包含闭合点"
   - 如果目标软件需要显式闭合，则勾选此选项

## 快捷工作流

### 快速导出到剪贴板

1. 选择对象
2. 点击"导出坐标"
3. 保持默认设置（CSV，当前中心点）
4. 点击"复制到剪贴板"
5. 在其他应用中 Ctrl+V 粘贴

### 完整数据备份

1. 选择所有对象（Ctrl+A 或框选）
2. 点击"导出坐标"
3. 选择JSON格式，自定义参考点为实际GPS坐标
4. 点击"下载文件"
5. 保存为 `project_backup_2024xxxx.json`

## 故障排除

### 问题：导出的坐标值很大（数千米）

**原因**：参考点距离对象较远

**解决**：
- 使用"使用第一个节点"作为参考点
- 或者手动输入更接近对象的参考点坐标

### 问题：导出坐标为负值

**原因**：对象在参考点的西侧或南侧

**解决**：这是正常的，负值表示方向：
- x为负：对象在参考点西侧
- y为负：对象在参考点南侧

### 问题：导出的数据精度不够

**解决**：在"小数位数"选项中增加位数（如改为4或6位）

### 问题：JSON格式打开后格式混乱

**解决**：
1. 复制JSON内容
2. 访问 https://jsonformatter.org/
3. 粘贴并格式化查看

## 相关功能

- **批量坐标导入**：从文件导入坐标点（与导出对应）
- **手动输入坐标**：逐点输入坐标创建多边形
- **平移坐标**：批量调整所有对象的位置（修改参考点）

## 技术细节

### 支持的对象类型
- Way（路径/多边形）
- Node（节点，导出为单个坐标点）

### 导出数据结构（JSON）

```json
{
  "reference": {
    "lon": 116.39749723432508,
    "lat": 39.90850926346065,
    "description": "Reference point for coordinate system"
  },
  "coordinateType": "meters",
  "exportTime": "2024-01-15T10:30:00.000Z",
  "objects": [
    {
      "id": "way_1704876123456",
      "type": "way",
      "tags": {
        "building": "yes",
        "name": "Building A"
      },
      "coordinates": [
        {"x": 12.50, "y": 8.30},
        {"x": 22.50, "y": 8.30},
        {"x": 22.50, "y": 0.00},
        {"x": 12.50, "y": 0.00}
      ],
      "closed": true
    }
  ]
}
```

### 文件命名规则

- CSV：`coordinates_YYYYMMDD_HHMMSS.csv`
- JSON：`coordinates_YYYYMMDD_HHMMSS.json`
- TXT：`coordinates_YYYYMMDD_HHMMSS.txt`

时间戳确保每次导出都有唯一的文件名。

---

**提示**：导出功能与批量导入功能完全互补，可以实现"导入→编辑→导出"的完整工作流！
