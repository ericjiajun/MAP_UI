# 坐标导入功能使用说明

## 功能概述
新增的"导入坐标"功能专为室内建筑平面图设计，支持精确到小数点后多位的坐标输入，自动创建闭合多边形并导出为标准OSM格式。

## 使用步骤

### 1. 打开导入对话框
点击工具栏 **文件 → 导入坐标** 按钮

### 2. 选择坐标系统类型
- **经纬度 (lon, lat)** - 直接使用WGS84经纬度坐标
- **米制坐标 (x, y)** - 相对于参考点的米制坐标，需设置参考点经纬度
- **场景坐标 (x, y)** - 使用当前编辑器设置的场景原点

### 3. 设置参考点（仅米制坐标）
如果选择"米制坐标"，需要设置参考点：
- 手动输入经纬度
- 或点击"用当前中心"按钮使用当前视图中心

### 4. 选择输入格式
- **CSV格式** - 每行一对坐标，用逗号分隔
- **JSON数组** - 标准JSON数组格式
- **空格分隔** - 每行一对坐标，用空格或制表符分隔

### 5. 输入坐标数据

#### CSV格式示例（室内矩形房间）
```
0.00, 0.00
10.50, 0.00
10.50, 8.30
0.00, 8.30
```

#### JSON格式示例
```json
[[0, 0], [10.5, 0], [10.5, 8.3], [0, 8.3]]
```

#### 空格分隔示例
```
0.00 0.00
10.50 0.00
10.50 8.30
0.00 8.30
```

### 6. 设置选项
- **自动闭合多边形** - 自动连接首尾点形成闭合图形（推荐勾选）
- **导入前清除现有数据** - 如果要替换当前所有数据，勾选此项

### 7. 添加标签（可选）
- **building标签** - 默认为"yes"，可改为"residential"、"commercial"等
- **名称** - 为建筑添加名称

### 8. 预览和导入
- 点击**预览**按钮查看解析结果
- 确认无误后点击**导入**按钮

## 实际应用案例

### 案例1：室内L型房间（米制坐标）
假设你有一个L型房间的测量数据（单位：米）：

**步骤：**
1. 选择"米制坐标"
2. 设置参考点为建筑中心：经度 116.404, 纬度 39.915
3. 选择CSV格式
4. 输入坐标：
```
0.00, 0.00
12.00, 0.00
12.00, 6.00
8.00, 6.00
8.00, 10.00
0.00, 10.00
```
5. 勾选"自动闭合多边形"
6. 设置 building="yes", name="L型会议室"
7. 点击导入

### 案例2：多个房间（使用经纬度）
如果你已经有精确的经纬度坐标：

```csv
116.40400, 39.91500
116.40410, 39.91500
116.40410, 39.91505
116.40400, 39.91505
```

直接选择"经纬度"类型导入即可。

### 案例3：从CAD导出数据
如果从AutoCAD或其他CAD软件导出：

1. 在CAD中选择一个角点作为原点(0,0)
2. 导出所有顶点的相对坐标
3. 在编辑器中：
   - 选择"米制坐标"
   - 设置该原点对应的真实经纬度
   - 粘贴CAD导出的坐标
   - 导入

## 坐标转换说明

### 米制坐标转经纬度
系统使用简化的平面近似转换：
- **纬度方向**: 1度 ≈ 111,320米
- **经度方向**: 1度 ≈ 111,320 × cos(纬度) 米

公式：
```
经度 = 参考点经度 + (X米 / 每度米数)
纬度 = 参考点纬度 + (Y米 / 111320)
```

**注意**：此转换适用于小范围（几公里内）的平面测量，大范围需使用更精确的投影转换。

## 导出OSM格式

导入的坐标会自动创建为标准OSM格式：

```xml
<?xml version="1.0" encoding="UTF-8"?>
<osm version="0.6" generator="OSM Editor Refactored">
  <node id="1" lat="39.91500000" lon="116.40400000"/>
  <node id="2" lat="39.91500000" lon="116.40410000"/>
  <node id="3" lat="39.91505000" lon="116.40410000"/>
  <node id="4" lat="39.91505000" lon="116.40400000"/>
  <way id="1">
    <nd ref="1"/>
    <nd ref="2"/>
    <nd ref="3"/>
    <nd ref="4"/>
    <nd ref="1"/>
    <tag k="building" v="yes"/>
    <tag k="name" v="示例建筑"/>
    <tag k="area" v="yes"/>
  </way>
</osm>
```

点击工具栏的**导出**按钮即可保存为.osm文件。

## 精度说明

- **输入精度**：支持任意小数位数（建议2-6位）
- **内部存储**：使用JavaScript双精度浮点数（约15位有效数字）
- **导出精度**：经纬度保留7位小数（约1厘米精度）

## 常见问题

### Q: 导入后图形变形？
A: 检查：
1. 坐标系统类型是否选对
2. 米制坐标的参考点是否设置正确
3. 坐标顺序是否为 (X, Y) 或 (lon, lat)

### Q: 导入后看不到图形？
A: 导入成功后会自动适应窗口。如果仍看不到：
1. 检查坐标数值范围是否合理
2. 点击工具栏"适应"按钮
3. 尝试缩放视图

### Q: 如何导入多个建筑？
A: 两种方式：
1. 逐个导入，每次取消勾选"导入前清除现有数据"
2. 手动编辑输入，用空行分隔不同建筑（需修改代码支持）

### Q: 坐标精度会丢失吗？
A: 不会。内部使用双精度浮点数存储，足以保持厘米级精度。

## 技术说明

该功能完全兼容标准OSM数据格式，导入的数据可以：
- 在编辑器中正常编辑、移动、标注
- 导出为标准OSM XML文件
- 与其他OSM数据混合使用
- 使用撤销/重做功能（但批量导入会清空历史记录）

## 下一步扩展

建议的功能增强：
- [ ] 支持批量导入多个多边形（用空行分隔）
- [ ] 支持导入圆形、圆弧等曲线
- [ ] 支持从Excel/CSV文件直接拖拽导入
- [ ] 支持不同坐标系的高精度投影转换
- [ ] 支持DXF格式导入
