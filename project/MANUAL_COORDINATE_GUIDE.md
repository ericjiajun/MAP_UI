# 手动输入坐标功能使用指南

## 功能介绍

这是一个**逐点交互式输入精确坐标**的功能，专为室内建筑平面图绘制设计。你可以像在CAD软件中一样，一个点一个点地手动输入精确坐标（精确到小数点后多位），实时预览，最后一键创建多边形。

## 快速开始

### 1. 打开对话框
点击工具栏：**文件 → 手动输入**

### 2. 选择坐标类型
- **经纬度 (lon, lat)** - 直接输入WGS84经纬度
- **米制坐标 (x, y)** - 相对于参考点的米制坐标（推荐用于室内建筑）

### 3. 逐点输入坐标

#### 方法一：手动逐点添加
```
输入 X: 0.00
输入 Y: 0.00
点击"添加点"或按Enter → 第1个点已添加

输入 X: 10.50
输入 Y: 0.00
按Enter → 第2个点已添加

输入 X: 10.50
输入 Y: 8.30
按Enter → 第3个点已添加

输入 X: 0.00
输入 Y: 8.30
按Enter → 第4个点已添加
```

### 4. 查看已输入的点
对话框中会实时显示已输入的所有点，包括：
- 点的序号
- 精确坐标值
- 删除按钮（可单独删除某个点）

### 5. 实时预览
当输入2个或以上点时，会自动显示预览信息：
- 路径/多边形类型
- 总长度或周长

### 6. 创建图形
确认无误后，点击"创建路径/多边形"按钮

## 详细操作指南

### 快捷键操作
- **Tab / Enter** - 从X坐标框跳到Y坐标框
- **Enter** - 在Y坐标框按Enter快速添加点
- 连续输入时无需点击鼠标，只需：
  ```
  输入X → Enter → 输入Y → Enter → 自动添加 → 输入下一个X...
  ```

### 点的管理
- **添加点** - 输入坐标后点击"添加点"或按Enter
- **删除单个点** - 在点列表中点击对应行的"删除"按钮
- **撤销最后一个点** - 点击"撤销"按钮
- **清空所有点** - 点击"清空"按钮（需确认）

### 坐标类型详解

#### 经纬度模式
直接输入WGS84经纬度坐标：
```
点1: 116.404000, 39.915000
点2: 116.404100, 39.915000
点3: 116.404100, 39.915050
点4: 116.404000, 39.915050
```

#### 米制坐标模式（推荐用于室内）
1. 设置参考点（建筑的某个角点或中心点的真实经纬度）
2. 输入相对于参考点的米制坐标
3. 系统自动转换为经纬度

**示例：10m×8m矩形房间**
```
参考点: 116.404, 39.915
点1: 0.00, 0.00      (参考点位置)
点2: 10.00, 0.00     (向东10米)
点3: 10.00, 8.00     (向东10米，向北8米)
点4: 0.00, 8.00      (向北8米)
```

### 自动闭合选项
- **勾选"自动闭合多边形"** - 自动连接首尾点，创建封闭图形（适合建筑）
- **取消勾选** - 创建开放路径（适合道路、走廊等）

### 建筑标签
- **building标签** - 默认"yes"，可改为：
  - `residential` - 住宅
  - `commercial` - 商业
  - `office` - 办公
  - `industrial` - 工业
  - 等等
- **名称** - 为建筑添加名称标识

## 实际应用案例

### 案例1：标准矩形房间

**场景**：绘制一个10.5m × 8.3m的精确矩形会议室

**步骤**：
1. 点击"文件 → 手动输入"
2. 选择"米制坐标"
3. 设置参考点（或用当前视图中心）
4. 依次输入四个角点：
   ```
   0.00, 0.00     [Enter]
   10.50, 0.00    [Enter]
   10.50, 8.30    [Enter]
   0.00, 8.30     [Enter]
   ```
5. 勾选"自动闭合多边形"
6. 设置：building=yes, name=会议室A
7. 点击"创建路径/多边形"

**结果**：创建一个精确的矩形建筑，自动计算周长约37.6m

### 案例2：L型房间

**场景**：绘制L型办公区

**输入坐标**（米制）：
```
0.00, 0.00
12.00, 0.00
12.00, 6.00
8.00, 6.00      ← 注意这里形成拐角
8.00, 10.00
0.00, 10.00
```

**技巧**：
- 按顺时针或逆时针顺序输入
- 拐角处要特别注意坐标
- 可以随时"撤销"输错的点

### 案例3：带小数精度的房间

**场景**：从精确测量得到的数据

**输入**：
```
0.00, 0.00
10.56, 0.00
10.56, 8.34
7.23, 8.34
7.23, 5.67
0.00, 5.67
```

**优势**：
- 支持任意小数位数
- 保持厘米级精度
- 导出OSM时保留7位小数

### 案例4：从CAD数据输入

**场景**：已有CAD平面图，需要在地图上绘制

**方法**：
1. 在CAD中选择一个角点作为原点
2. 导出各顶点的相对坐标（如DXF格式）
3. 在编辑器中：
   - 打开"手动输入"
   - 选择"米制坐标"
   - 设置该角点的真实经纬度作为参考点
   - 逐个输入CAD中的坐标
4. 创建后可导出为OSM格式

## 与其他功能的区别

| 功能 | 适用场景 | 输入方式 |
|------|---------|---------|
| **手动输入** | 少量点，逐点精确输入 | 交互式，一个一个输入 |
| **批量坐标** | 大量点，已有完整数据 | 一次性粘贴所有坐标 |
| **鼠标绘制** | 快速草图，不要求精度 | 点击画布添加点 |

## 操作技巧

### 1. 快速连续输入
```
输入流程：
X值 → Enter → Y值 → Enter → 自动添加
→ 光标回到X框 → 继续输入下一个点
```

### 2. 修正错误
- **输错一个点** → 点击该点的"删除"按钮
- **输错最后一个点** → 点击"撤销"按钮
- **全部重来** → 点击"清空"按钮

### 3. 实时检查
- 查看点列表确认坐标正确
- 注意点的顺序（影响图形形状）
- 观察预览信息（周长/长度是否合理）

### 4. 参考点设置技巧
对于米制坐标：
- **方法1**：在地图上找到建筑角点，用其经纬度作为参考点
- **方法2**：先在地图上大致定位，然后"用当前中心"
- **方法3**：使用已知的GPS测量点

## 导出与兼容性

创建的图形完全兼容OSM格式：

```xml
<osm version="0.6">
  <node id="1" lat="39.9150000" lon="116.4040000"/>
  <node id="2" lat="39.9150000" lon="116.4041000"/>
  <node id="3" lat="39.9150500" lon="116.4041000"/>
  <node id="4" lat="39.9150500" lon="116.4040000"/>
  <way id="1">
    <nd ref="1"/>
    <nd ref="2"/>
    <nd ref="3"/>
    <nd ref="4"/>
    <nd ref="1"/>
    <tag k="building" v="yes"/>
    <tag k="name" v="会议室A"/>
    <tag k="area" v="yes"/>
  </way>
</osm>
```

点击工具栏"导出"即可保存为.osm文件，可用于：
- 其他OSM编辑器（JOSM、iD等）
- GIS软件（QGIS、ArcGIS等）
- 自定义地图应用

## 精度保证

- **输入精度**：支持任意小数位数
- **内部计算**：双精度浮点（15位有效数字）
- **坐标转换**：米制→经纬度误差 < 1毫米
- **导出精度**：经纬度7位小数 ≈ 1厘米

## 常见问题

### Q: 输入时发现点的顺序错了怎么办？
A: 可以：
1. 删除后面的点，重新按正确顺序输入
2. 或者全部清空重新输入
3. 创建后也可以在编辑器中调整

### Q: 如何输入非矩形的复杂形状？
A: 按照图形的边界顺时针或逆时针依次输入各个拐点坐标即可。

### Q: 米制坐标的参考点设在哪里比较好？
A: 建议：
- 建筑的西南角（左下角）
- 建筑的中心点
- 任何一个方便记忆和测量的位置

### Q: 可以中途保存吗？
A: 目前不支持保存草稿。建议：
- 先在记事本整理好坐标
- 或者分段创建多个多边形

### Q: 创建后还能修改吗？
A: 可以！创建后的图形可以：
- 拖动节点调整位置
- 编辑标签
- 使用撤销/重做
- 删除重建

## 下一步增强建议

- [ ] 支持保存/加载坐标草稿
- [ ] 支持撤销/重做操作
- [ ] 支持从剪贴板批量粘贴（自动识别格式）
- [ ] 支持导入CSV文件
- [ ] 支持坐标变换（旋转、平移、缩放）
- [ ] 支持捕捉已有点（自动吸附）

## 总结

**手动输入功能**非常适合：
- ✅ 室内建筑精确绘制
- ✅ 从测量数据创建图形
- ✅ CAD数据迁移到地图
- ✅ 需要厘米级精度的场景
- ✅ 水平垂直规整的设计

配合批量导入和鼠标绘制功能，可以高效完成各类地图编辑任务！
