# 临时坐标绘制与后期平移工作流程

## 使用场景

**问题**：我有建筑的精确测量数据（米制坐标），但暂时还没有参考点的真实GPS坐标。

**解决方案**：先用临时参考点（如0,0）绘制，之后获得真实坐标时，一键平移到正确位置。

## 完整工作流程

### 阶段1：使用临时坐标绘制

#### 步骤1：打开手动输入对话框
- 点击工具栏：**文件 → 手动输入**

#### 步骤2：选择米制坐标 + 临时参考点
1. 坐标类型选择：**米制坐标 (x, y)**
2. 点击"**用临时原点(0,0)**"按钮
3. 此时参考点设为：经度=0, 纬度=0（临时坐标）

#### 步骤3：输入测量数据
按照你的实际测量数据输入坐标（单位：米）：

```
示例：10m × 8m 的矩形房间
0.00, 0.00     [Enter]
10.00, 0.00    [Enter]
10.00, 8.00    [Enter]
0.00, 8.00     [Enter]
```

#### 步骤4：创建图形
- 勾选"自动闭合多边形"
- 点击"创建路径/多边形"
- 建筑绘制完成，但位置在(0,0)附近（临时位置）

#### 步骤5：继续绘制其他建筑
- 重复步骤1-4，绘制所有需要的建筑
- 都使用相同的临时参考点(0,0)
- 建筑之间的相对位置和尺寸是正确的

#### 步骤6：保存工作（可选）
- 点击"导出"保存为OSM文件
- 即使坐标是临时的，也可以保存以防丢失

---

### 阶段2：平移到真实坐标

当你获得了真实的GPS坐标后：

#### 步骤1：打开平移对话框
- 点击工具栏：**坐标系统 → 平移坐标**（橙色按钮）

#### 步骤2：选择平移方式

有两种方式可选：

##### 方式A：绝对位置平移（推荐）
1. 选择"**绝对位置平移**"
2. 填写原参考点：经度=0, 纬度=0（之前的临时原点）
3. 填写新参考点：真实的GPS坐标
   - 例如：经度=116.404000, 纬度=39.915000

```
原参考点: (0, 0)           ← 临时坐标
新参考点: (116.404, 39.915) ← 真实GPS
```

##### 方式B：偏移量平移
如果你知道需要向东/北移动多少米：
1. 选择"**偏移量平移**"
2. 输入向东偏移（米）和向北偏移（米）

#### 步骤3：预览平移
- 点击"**预览**"按钮
- 查看平移距离和新中心位置
- 确认是否正确

#### 步骤4：应用平移
- 确认无误后，点击"**应用平移**"
- 系统会询问确认
- 确认后，所有数据移动到真实位置

#### 步骤5：验证结果
- 加载底图（OSM或卫星）
- 检查建筑是否在正确的地理位置
- 如有偏差，可重复平移（使用小的偏移量微调）

---

## 实际案例演示

### 案例：某办公楼建筑群

**背景**：
- 有5栋建筑的CAD测量数据（米制坐标）
- 暂时没有GPS坐标
- 一周后测量队提供了参考点GPS

#### 第一天：绘制建筑（使用临时坐标）

**建筑A - 主楼（20m×15m）**
```
手动输入 → 米制坐标 → 临时原点(0,0)
0, 0
20, 0
20, 15
0, 15
创建 → building=yes, name=主楼
```

**建筑B - 附楼（12m×8m）**
```
手动输入 → 米制坐标 → 临时原点(0,0)
25, 0    ← 相对于主楼向东25米
37, 0
37, 8
25, 8
创建 → building=yes, name=附楼
```

**建筑C、D、E** - 按相同方式绘制...

此时所有建筑位置和相对关系都是正确的，只是整体位置在(0,0)附近。

#### 一周后：平移到真实位置

**获得真实坐标**：
- 测量队报告：建筑A的西南角（即我们的原点）实际位于：
  - 经度：116.404123
  - 纬度：39.915456

**执行平移**：
```
1. 点击"平移坐标"
2. 选择"绝对位置平移"
3. 原参考点：0, 0
4. 新参考点：116.404123, 39.915456
5. 预览 → 显示"将平移约12345米"
6. 应用平移
```

**结果**：
- 所有5栋建筑同时移动到正确位置
- 建筑之间的相对位置保持不变
- 加载卫星底图验证，完美对齐！

---

## 高级技巧

### 技巧1：使用有意义的临时原点

虽然(0,0)简单，但也可以用其他临时坐标：

```
临时原点可以选择：
- (0, 0)           ← 最简单
- (100, 100)       ← 避免负数
- (116, 39)        ← 粗略估计的经纬度
```

只要绘制时所有建筑用相同的原点，后期都能统一平移。

### 技巧2：分阶段验证

```
阶段1：绘制完立即导出
→ 保存为 buildings_temp.osm

阶段2：得到真实坐标后
→ 导入 buildings_temp.osm
→ 执行平移
→ 导出为 buildings_final.osm
```

### 技巧3：微调精度

如果平移后发现有小偏差：

```
1. 加载卫星底图
2. 对比实际建筑轮廓
3. 使用"偏移量平移"微调
   - 例如：向东偏移 -2.5米（向西2.5米）
   - 向北偏移 1.8米
4. 应用平移（勾选"保留原数据"以对比）
```

### 技巧4：批量处理多个项目

```
项目1：小区A → 临时原点(0, 0)
项目2：小区B → 临时原点(0, 1000)  ← 避免混淆
项目3：小区C → 临时原点(0, 2000)

后期分别平移到各自真实位置
```

---

## 平移功能详解

### 绝对位置平移 vs 偏移量平移

| 特性 | 绝对位置平移 | 偏移量平移 |
|------|------------|-----------|
| **适用场景** | 知道原点和目标点坐标 | 知道需要移动的米数 |
| **输入方式** | 两个GPS坐标点 | 东西/南北偏移米数 |
| **典型用途** | 从临时坐标到真实坐标 | 微调位置 |
| **计算方式** | 自动计算偏移量 | 直接使用输入偏移 |

### 保留原数据选项

```
不勾选（默认）：移动现有数据
→ 所有节点直接更新坐标
→ 适合最终定位

勾选：创建副本
→ 保留原数据，生成移动后的副本
→ 适合对比验证
```

---

## 常见问题

### Q1: 如果忘记了当初用的临时原点坐标？

A: 查看当前数据的中心位置：
```
1. 打开"平移坐标"对话框
2. 查看"当前数据范围"中的"中心点"
3. 如果中心点接近(0,0)，说明临时原点就是(0,0)
4. 如果偏离很多，可能用了其他临时原点
```

### Q2: 平移后发现位置不对，能撤销吗？

A: 两种方法：
1. **事前预防**：勾选"保留原数据"，创建副本而非移动
2. **事后补救**：导入之前导出的OSM文件

### Q3: 可以多次平移吗？

A: 可以！每次平移都是基于当前坐标：
```
第一次平移：(0,0) → (116.40, 39.91)
发现偏了2米
第二次平移：使用偏移量(-2, 0)米微调
```

### Q4: 平移会影响图形的尺寸和形状吗？

A: **不会**！平移只改变位置，不改变：
- 建筑尺寸
- 建筑形状
- 建筑之间的相对位置
- 建筑的朝向

### Q5: 多个独立区域怎么分别平移？

A: 需要分别处理：
```
方法1：分文件绘制
→ 区域A单独绘制并导出
→ 区域B单独绘制并导出
→ 分别平移后再合并

方法2：使用选择工具
→ 框选区域A的所有建筑
→ 暂时不支持选择性平移（待开发）
```

---

## 工作流程检查清单

### 绘制阶段 ✓
- [ ] 确定使用临时原点（记录下来！）
- [ ] 使用"手动输入"逐点输入坐标
- [ ] 确认建筑相对位置正确
- [ ] 导出保存临时文件

### 平移阶段 ✓
- [ ] 获得真实GPS坐标
- [ ] 打开"平移坐标"对话框
- [ ] 选择"绝对位置平移"
- [ ] 正确填写原/新参考点
- [ ] 预览确认平移距离合理
- [ ] 应用平移
- [ ] 加载底图验证位置

### 验证阶段 ✓
- [ ] 与卫星底图对比
- [ ] 检查关键建筑轮廓
- [ ] 必要时微调（小偏移）
- [ ] 最终导出

---

## 总结

使用"临时坐标 + 后期平移"工作流的优势：

✅ **即时开工**：无需等待GPS测量，立即开始绘制
✅ **专注精度**：绘制时专注于相对位置和尺寸
✅ **灵活调整**：真实坐标到位后，一键平移
✅ **无损转换**：保持所有尺寸和相对位置
✅ **可重复操作**：支持多次微调
✅ **批量处理**：所有建筑同时平移

这个工作流程特别适合：
- 室内建筑平面图绘制
- 大型建筑群项目
- 需要先期规划后期定位的场景
- CAD数据向GIS迁移
